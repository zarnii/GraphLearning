<UserControl x:Class="GraphApp.View.VisualEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:GraphApp.View"
			 xmlns:model="clr-namespace:GraphApp.Model"
			 xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="70"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>

		<Grid Grid.Column="0" Style="{StaticResource GridStyle}" />

		<Grid Grid.Column="0">
			<StackPanel>
				<Button 
						Margin="0,5,0,0" 
						Content="Курсор" 
						Command="{Binding ChangeMouseMode}" 
						CommandParameter="{x:Static model:MouseMode.Default}"
						Style="{StaticResource ButtonStyle}"
						Height="25"/>
				<Button 
						Margin="0,5,0,0" 
						Content="Создать" 
						Command="{Binding ChangeMouseMode}" 
						CommandParameter="{x:Static model:MouseMode.Create}"
						Style="{StaticResource ButtonStyle}"
						Height="25"/>
				<Button 
						Margin="0,5,0,0" 
						Content="Соединить" 
						Command="{Binding ChangeMouseMode}" 
						CommandParameter="{x:Static model:MouseMode.Connect}"
						Style="{StaticResource ButtonStyle}"
						Height="25"/>
				<Button 
						Margin="0,5,0,0" 
						Content="Удалить" 
						Command="{Binding ChangeMouseMode}" 
						CommandParameter="{x:Static model:MouseMode.Delete}"
						Style="{StaticResource ButtonStyle}"
						Height="25"/>
			</StackPanel>
		</Grid>

		<Grid Grid.Column="1" >
			<Rectangle Fill="#1a1a1a" Stroke="#424242">
				<i:Interaction.Triggers>
					<i:EventTrigger EventName="MouseLeftButtonDown">
						<i:InvokeCommandAction Command="{Binding ClickOnField}" PassEventArgsToCommand="True"/>
					</i:EventTrigger>
				</i:Interaction.Triggers>
			</Rectangle>
			<ItemsControl ItemsSource="{Binding Connections}">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<Canvas/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Line X1="{Binding X1}" Y1="{Binding Y1}" X2="{Binding X2}" Y2="{Binding Y2}" Stroke="Black" StrokeThickness="4">
							<i:Interaction.Triggers>
								<i:EventTrigger EventName="PreviewMouseDown">
									<i:InvokeCommandAction Command="{Binding Path=DataContext.ClickOnConnection, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" CommandParameter="{Binding}"/>
								</i:EventTrigger>
							</i:Interaction.Triggers>
						</Line>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
			<ItemsControl ItemsSource="{Binding Vertices}">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<Canvas/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
				<ItemsControl.ItemContainerStyle>
					<Style>
						<Setter Property="Canvas.Left" Value="{Binding X}"/>
						<Setter Property="Canvas.Top" Value="{Binding Y}"/>
					</Style>
				</ItemsControl.ItemContainerStyle>
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Thumb>
							<Thumb.Template>
								<ControlTemplate>
									<Ellipse Width="{Binding Width}" Height="{Binding Height}" Fill="{Binding Color}">
										<i:Interaction.Triggers>
											<i:EventTrigger EventName="PreviewMouseDown">
												<i:InvokeCommandAction 
														Command="{Binding Path=DataContext.ClickOnVertex, 
															RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" 
														CommandParameter="{Binding}"/>
											</i:EventTrigger>
										</i:Interaction.Triggers>
									</Ellipse>

								</ControlTemplate>
							</Thumb.Template>
							<i:Interaction.Triggers>
								<i:EventTrigger EventName="DragDelta">
									<i:InvokeCommandAction 
											Command="{Binding Path=DataContext.MoveVertex, 
												RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
											PassEventArgsToCommand="True"/>
								</i:EventTrigger>
							</i:Interaction.Triggers>
						</Thumb>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
		</Grid>
	</Grid>
</UserControl>
